# HOW TO FILTER A LIST FIELD BASED ON ASSOCIATION WITH ANOTHER FIELD


### Explanation Of Filter Fields
 
Hi I don't know some of you also have encountered the reality of having sort of limit the drop downs of a list field based on it's association with another table. A very common place where we find this [00:00:22](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h00m22s) is for example when you want to load the regions of only one country. I'm going to show you how I have achieved this I realize there are many ways to do this and yet this is how I've done it. 

* ### Example Component With Filters

To start off, I have a component I could use as a illustration called job tracking. Now in this component [00:00:50](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h00m50s) I have a client area. Then I have already loaded, I go to admin views, you would see there is country and regions. Now I'm going to illustrate it on the basis of country and regions but you can change the field concepts and replace it with other tables. [00:01:16](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h01m16s) None the less this is what I'll be using. I'm going to show you how I implemented it in inside the client's view because that's where most of the work is done. 

I'm going to look in the two places we want to look at JavaScript, as well as the php area. Now I have in various previous tutorials explain some of the Ajax functionality [00:01:51](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h01m51s) in component builder. I realized not all of you might have watched all the tutorial so I'll explain some of that again briefly. But having said that we first going to look at what we really want to achieve. [00:02:19](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h02m19s) When you start with a client, you would like to choose a country. Then have it load only that country's regions, that is what you want to do. Furthermore you want to make sure when it does that, you unselect [00:02:41](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h02m41s) the country, it also unselects the region. There are various things we want to achieve here. So in JavaScript I'm going to show you how I've done that. I'm just illustrating at the moment one country. Maybe I should go put on a few more, so now if I look it says Australia. If I click on Australia, [00:03:10](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h03m10s) you will see that it doesn't load any regions in fact that says create a region. If I choose Namibia, it says select a region, and so there's two regions already created. Now as you know by now there is this button(see video). In some of the dropdowns which are being added by saying true to the button. It's very helpful for either creating or editing existing regions. So if you could sort of selecting a country where there isn't any regions set yet, [00:03:44](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h03m44s) it tells you to create one. You can then create a region for this country, and what's nice if you click on this create, you can then simply create your region. Save and close. I don't know any of Australia regions, I'm just going to call it Region for now. Save and close. Go back to creating a client. [00:04:17](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h04m17s) If I now select Australia you will see that it's got regions. So there we go, problem solved. And that's what I'm going to demonstrate how I did that. 

### Two Variables - Var Regions(object) Var Region(store)

So let's get started on a JavaScript side of things. I first have two variables. I could call them both var. [00:04:42](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h04m42s) One is an object, one is where we are going to store, if there is a value already set. We're going to store that value. Creating the fields I make it bring all the regions to the page, I don't want it to [00:05:11](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h05m11s) leave some regions on unloaded. Instead what I rather do is I parse those regions into this variable. And then only put those regions that are part of this country back into the list of dropdown options. What you also see happening here, first thing I'm doing is I am [00:05:43](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h05m43s) doing it for each on the regions options. And then I'm getting the value. I putting it in (var)key, I'm getting the text, I'm putting it in (var)text, and then I'm adding it to regions(Key)=text;. Simply as you would load it in any array there. And then I am also [00:06:08](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h06m08s) Getting the value of the set region(see video). And I'm adding that to region. And then I'm setting the function getregion. The getregion function is down here. 

### Loading Show - Class ID

The first thing we do is we load the loading show. The loading show or rather this class id, [00:06:34](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h06m34s) is loaded on the page by default when you set Fade in Affect on add. Then it by default loads that class with a nice spinner. If the loading process takes long I'm stopping the user from doing anything waiting for that spinner, [00:06:58](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h06m58s) you don't need to add that. Then I am finding the options for the region, I'm removing all of them. Then I'm triggering an update. This update that we are triggering here lizt, is a Joomla function. [00:07:19](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h07m19s) It's possibly going to change in the future. So keep that in the back of your mind. If things break, it is possible happening right here. Because this list field is dynamically generated by Joomla. And so we literally telling it draw that list again. But after having removed everything. 

### GetRegion

We are looking at the country. [00:07:51](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h07m51s) So up till here we only touched the region. Now we get the country value. The one that is selected. We add it to country. We then call the server at this point. The only thing we are giving the server is the country id. Up here we have a country id. We have our getUrl. In our case is getRegion [00:08:16](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h08m16s) is the task. We checking that the token is on the page. Checking that a country id is not zero. We then basically loading the request and shooting of an Ajax. We doing it this way because we want to do some things after we've got the result which is this 'done'. And then  [00:08:40](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h08m40s) we setRegion. We throw the result into setRegion, we hide the load, and then we do some house cleaning on the button. So that button also gets tampered with. I'll show you the correction region button that we are doing down here. [00:09:05](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h09m05s) You can copy this code, test that out. You would update this(region) to whatever field you trying to limit. Only do that after setRegion. 

### SetRegion

Now we going to setRegion. setRegion is quite simple. Mainly because we already done most of the work with the result being returned. I'll show you the PHP that returns this result in the moment. In setRegion we would get an array, we check if the array is there, [00:09:38](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h09m38s) and then we append. Simply as you would with any list selection, we append the value.

* ### Strings - Select_A_Region, Create_A_Region

Another thing I'm almost skipping it, this select_a_region [00:09:55](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h09m55s) is a JavaScript variable that I'm setting through PHP, which I'll show you in a later stage. Basically it's just a string that says that you should select the region. If there is no array returned, we just use the other variable, [00:10:21](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h10m21s) create_a_region which is also just a string. Over here we are going to each over the array, and we are using the id, and we checking whether the id is in regions. If it's in regions, we append the id as a value. As you remember in regions we saved the text as well as the id. [00:10:51](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h10m51s) And so that is how we get the text, simply adding it in there(see video). I know we could have done that in the PHP, but I felt let the browser help us with some of the lifting. We got the regions there, if it's a huge table you might want it should approach this differently. Eventually we are checking whether the id and the region ==. Since if it does we want to ensure to set region value. As your member previously [00:11:25](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h11m25s) we found the region value, we stored it into region. Just in case the value was set before and saved. Now the person is looking through different countries. But when you can select the country that previously was saved, we want to make sure that this previous region is also shown as the selected value. That's simply what we are doing here(jQuery(#jform_region)val(id)). Then after everything is done we again trigger this liszt:Updated. [00:11:58](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h11m58s)  Which is the same as what was triggered there(see video). That sets the regions list again afresh. Then do we run this(see video) little bit of housekeeping which does the region button. 

### RegionButton Correction 

Now the region button is actually a JavaScript [00:12:22](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h12m22s) that is added because of the list field. so if your specific list field was set to have no button, you could simply leave this out. If it was set to have a button, the name of the button would be this area before the jform_. This part(region) of the name would be the first part of the name of the button function, and then the last part would be button. [00:12:54](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h12m54s) So that's how you can on the page let it execute and search for this(regionButton) function, if you aren't sure. That's how you would run the button correction. And that's how JavaScript looks to achieve this. There is a little bit more housework necessary and that's what I said before. This area of JavaScript can actually include [00:13:25](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h13m25s) PHP. That area can not because that's just pure JavaScript file. Where's this is JavaScript added to a PHP file. Here we can add some PHP and that's where we get the select_region and create_region. 

### JavaScript - AdminForm.on(change) 

Now I know there is another way to do this in Javascript itself. There's this function, the adminForm.on(change) of the country field is when that event occurs, we want to execute getRegion. [00:14:06](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h14m06s) That is done every time that field is changed. What is the extra bit of Script that you need to add these two. If you are going to copy this down exactly the same. Just another note. That will execute this function. Which is the same function that we are executing [00:14:33](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h14m33s) on the page load. We don't need to execute this. Simply because that is already been done on the page load. That is all the JavaScript that you need to add. 

### PHP - Ajax Method - Model - Controller

Now let's go look at the PHP. Should know by now you do not need to add the PHP to the same admin view. Since all the ajax methods are all added to one file in the component called, Ajax, the model as well as the controller, is the Ajax model and controller. If you compile the component [00:15:13](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h15m13s) you can unzip it and go to the model, and to the controller, either in the back end or in the front end. Where as for now it will be in the back end, it's under models. You look there's an Ajax model and all of the back end Ajax methods gets added to this one model. And so this(php ajax method) area is what takes care of the model. [00:15:37](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h15m37s) And this(Ajax input - add) area here takes care of the controller. So basically it is saying the values name is country, the task is getRegion, if no values passed it's Null. It must be an integer that is past, and the method name is getRegion. And it must be a login user. That's a simple as that. That takes care of the whole controller setup. 

Then here(php ajax method)  [00:16:08](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h16m08s) we have the method called getRegion, it gets the id. It doesn't need to sanitize it again since the controller already did that. You can go look at the controller to see the implementation. So we simply getting the factory, the data base factories passes us the database, we set up a query, we say that we are looking for the ids in the region that are published. [00:16:38](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h16m38s) Now this is again where you need to make your changes. We want the names of the regions on their association with the country. Then in the region table, we have a field, a column, that is called country. It has an id in it. [00:17:06](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h17m06s) So that each region is linked to a country. Whatever table you're targeting, this association would be than this country. We just add the interger there again. Set the query, execute it, check if you have a value. And if we do we simply return the loadcolumn function, [00:17:33](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h17m33s) which returns the id in an array. There we go done. Finished. And then we return false, if no value was found. That's all the PHP you need. And that returns the PHP to our JavaScript. And the JavaScript does the rest. [00:17:57](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h17m57s) I hope this will be very helpful, and help you to sort your dropdowns. I didn't spend much time on explaining that maybe I should. Let me give a quick run over of that. 

### Filtering a Dropdown

The field that we are focusing on is this country in the region field and they are both custom. I've already done tutorials on how to set up a custom field. Just for a reminder, let's open region. In region we simply saying the button is true. [00:18:34](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h18m34s) We select the region, you can update the view name dynamically in the description. In here(XML field definition) we doing some PHP. You could put all of this PHP in type_PHP_1 without adding it to the 19th placement. I've actually used every area, [00:19:05](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h19m05s) I like making the code look as it was written and not computer-generated. Then I'm adding the options, and so this is just a simple basic custom field. There isn't even any JavaScript in here. I've done everything in back end admin view. Did the PHP as well as the Javascript. I think that is because I want to use this field maybe in other views with different [00:19:44](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h19m44s) association. So I don't tend to use the script area maybe as one might expect. So that's quickly looking at filtering a dropdown custom list selection via JavaScript and Ajax. If you are targeting a table of another component which you're not having the control over [00:20:15](https://www.youtube.com/watch?v=Z8FLifQOjUk&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h20m15s) the actual field names, it will work the same way as long as there is a field of association within the table that you'd like to filter you could write that PHP. Find the values and filter it.
