# EXPORT IMPORT OF FULLY MAPPED COMPONENTS

### Various Linked Concepts to A component is Exported 

We're happy to announce a new feature that's been added to the advanced component builder for Joomla. [00:00:10](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h00m10s) This feature is a feature I suppose can become very useful in the future of JCB. It allows you to export a component out of JCB, and not only the component's information, but everything attached to it. [00:00:34](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h00m34s) If the component has admin views linked to it, and those admin views have fields linked to it, and those fields have field types linked to it, and those component has site views, and custom admin views, and those site views and custom admin views has templates and layouts, and dynamic gets, and all these various linked concepts to a component is exported. [00:01:09](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h01m09s) 
Ok so 
### Two Ways To Export A Component - Encrypted And Non Encrypted

The way that you will export a component is you'd simply click on export component. You need to select the component or components that you would like to export. There's a few things to say when we want to export a component. There are two ways in which we export a component. One is [00:01:36](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h01m36s) an encrypted way, and the other is non encrypted. 

### Smart Export Builder

Let me show you that in the code. So I like you to understand exactly how it works. So we have a method here called smartExportBuilder. Now SmartExportBuilder gets fired at the very end of the compilation or rather the build. Where all the data has now been extracted from the database [00:02:05](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h02m05s) and it's now one big array of objects. In this function called getSmartExport, is where this data extrusion takes place. 

### Export Key

During this process we actually [00:02:25](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h02m25s) take an account of a specific value. That value's name is export key. So in this 'foreach' we are looping through the components that you've selected. If you selected more than one, then it will check whether there is an export key for that component. Let me show you where that is a set in the user interface. When you open a component, [00:03:00](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h03m00s) it has a tab called settings. At the bottom of the right-hand column it has a new field called export key. You can put any value in here. If you leave this value empty, and you export only this(sermonDistributor) component, then the component will not be encrypted. If you add a value to this(export key) field [00:03:32](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h03m32s) and you export this component it will encrypt that component's data, the database values. It will not encrypt attached files or folders or images that are part of this component. It will only encrypt the data from the database. 

### Export Key - Encrypt All Components

Having said that, [00:03:54](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h03m54s) if you select multiple components, and any one of them has a key, then it will encrypt all the components. I'll explain again in the code how this is done. We go back to the code. In the code we are asking, does this component have an export key? [00:04:16](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h04m16s) If it's true and it has a string, this Ok so key is encrypted in a database. We first check that it is able to be encrypted, and then we encrypt the key. Then we add it to the key array with the component's id. Basically we are building up an array [00:04:41](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h04m41s) of each component's key. If a component does not have a key, it simply ignores this little script and it continues building its data set. Then once all the data set of all components are finished, we get to the smartExportBuilder I spoke of when we started looking at the code. In this smartExportBuilder we are simply asking, have we found any keys? 

### If Any Key - Implode The array

If we have found any keys, [00:05:15](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h05m15s) we are going to implode the array, convert it to md5 string. We will then use this md5 string with an Aes encryption cypher to lock the data. [00:05:37](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h05m37s) So there is the data. Now above here we already changed the whole data set to a serialized string. So we have a string in this(data) variable. And here we are encrypting the whole string. In this(data) variable we have the encrypted value. If we don't have any keys, even if that means if none of the components that was selected had any keys set, then it will default to simply [00:06:09](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h06m09s) do a base64_encode. If that is well, then it gets written to the file that's part of the package. So that is how it exports the data. I'm not going to explain much about the actual mechanics that's happening here in the bottom of the file. You're welcome to look through it. If you see any room for improvements, you're welcome to make a pull request. [00:06:43](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h06m43s) So it exports the data and then checks whether we have any keys. So if you have, for example exporting five components, and all five components have keys, in all five keys will create a very long string, and then that whole string will be changed into an md5 string which is 32 characters. And that 32 characters is then used to encrypt the data. [00:07:13](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h07m13s)
Basically 

### Exporting A Component - Generating A Key

This actual key which we then end up using to do the encryption, will be shown to you in the interface after the data is being exported. Let's go back to the user interface and let's export a component. I have this(Learning Manager) component, and it has a key. I have other components that has no keys at this stage. I'll select Learning Manager as a demonstration. [00:07:52](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h07m52s) Then I'll click export component. As you can see it generated a key for me, which I can then use to import this package into another JCB. I can import it into the same JCB. But it's obviously not necessary. I could use it as a backup. Now [00:08:19](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h08m19s) It is storing the compiled package in the temporary folder at this stage. I am working to determine whether we should make this placement of the file dynamic, that you could change it. I think it will be ideal if it automatically becomes a kind of backup method. We're even thinking of setting up a timer that could run backups of your components using this method. Anyway that's future planning. [00:08:55](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h08m55s) You have an exported component at the moment, if your data sets are not too big and your memory settings on your PHP and so forth is allowing this kind of compilation, you could select all components and export them. The same will be the result. Since I have only one component set with a key, [00:09:26](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h09m26s) they all will be encrypted with the same key. They all will be stored in this package. I have exported all my components into this one package. 

### Importing Components - JCB_smartPackage.zip

Now to demonstrate the importing of this(JCB_smartPackage.zip) data set, I have a blank website ready. [00:09:49](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h09m49s) Here's my blank website, it has no special JCB components. The first thing I'll do is I'm going to install JCB from GitHub. I'm going to GitHub and I will open the releases. [00:10:14](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h10m14s) I'll just copy the link to the latest release. Go back, paste that in here(Install From URL). And install it. The installation was successful. I'm going to Component Builder, then I'll open the components. As you can see [00:10:43](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h10m43s) I have only the demo component. I would like to move all these components that I have, over to the new install. I'm going to click on import components. Then I'm going to browse to that package that we've just exported. I'm going to upload it. [00:11:13](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h11m13s) 

### Two Features - Force Local Update - Use Key

We have two features here. This force local update, what it will do, is on normal circumstances if you do a import, the import function looks at the data that are currently in this JCB install. For example we're talking about field types, fields, admin views and site views. [00:11:42](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h11m42s) If it finds a site view that is being installed, that is already in the current database, it looks at the last modified date, and then by that determines whether the current installed version is newer. If it's newer it will by default ignore the new data and not install it. Sometimes you might get a package where you would like to force that it updates the current data even though it may be all the data. So this is why we have the switch, you can then click yes to force the update. [00:12:20](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h12m20s) We have a key for this package, so we'll leave this to yes. I'll just come over here(Joomla Components) and copy that key. This key will then always be necessary if you're importing this package. That will be it and we'll click continue. It might take a time since this is quite a huge dataset. You could just patiently wait. At last it is installed, it tells us that the install is being successful. You might get these warnings. 

### Warnings - Remapped

Now what these warnings is really telling you, [00:13:01](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h13m01s) is that during the install you realize that lots of ids will change. We are working with a database that creates ids as the new item is added. Since these are the ids is used to link into the various components, views and places, all these ids must be remapped. We have been able to  [00:13:30](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h13m30s) find a very well formulated algorithm to resolve this problem. So it remaps all the ids. Sometimes there are certain ids that wasn't possible to remap. We are telling you about them. You could see that the target field in the admin views has a mismatch in the field with id.244. You can go back to the old install, and try and find out what happened there. [00:14:04](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h14m04s) Most of the time when I have reviewed this, usually it is because that specific field is no longer published or is no longer available for some reason. So this is just giving you a heads up of any changes that may have occurred. You can go to these various places and manually fix them. Most of the time these warnings will not show and everything will just say all is right. If there is warnings and errors just simply read the messages slowly and closely. I'm sure you'll be able to resolve it [00:14:43](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h14m43s) quite easily. 

### Mapped Components

Now just to show you that it actually does work, I didn't mention before but it actually moves all the customer files, custom folders, as well as all the images per admin view, site view and wherever to the new install, so it moves it into its right place. So if that is true we should be able to go to the compiler, select any of the components. [00:15:19](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h15m19s) It should load that components image here, I should be able to just click compile. It should be able to simply compile that component after compilation. I could click installing the component. If this component was correctly mapped previously, and I were to go to that component, I would see that everything about the component is right and it works well. [00:15:51](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h15m51s) That is this new feature in action. I really hope that it will be as useful to you as it's going to be to me, and that you will have fun with it. I must tell you I suppose that at some point we could even start looking at selling mapped components. I have a number of components that was made for specific purposes, but could be easily adapted for others. [00:16:22](https://www.youtube.com/watch?v=lkE0ZiSWufg&list=PLQRGFI8XZ_wtGvPQZWBfDzzlERLQgpMRE&t=00h16m22s) I'm starting to look at the idea of selling mapped components. It's a little difficult because it's basically selling the rights to it in a way that you could resell it. So I'm not sure what would be the price tag of that.
